# 参数调整后测试结果分析

## 一、测试结果

### 实验配置
- **地图大小**: 24×24
- **UAV数量**: 4
- **障碍密度**: 0.20
- **调整后的参数**: 
  - ✅ 动态障碍回避权重: 6.5 (从8.0降低)
  - ✅ 高密度探索策略: epsilon_end=0.10 (从0.12降低), epsilon_decay=0.9997 (从0.9995减慢)
  - ✅ 高密度恢复设置: threshold=0.90 (从0.98降低), drop_tolerance=0.05 (从0.04增加)

### 结果对比

| 指标 | 改进前 | 第一次改进后 | 第二次调整后 | 变化 |
|------|--------|-------------|-------------|------|
| 最终覆盖率 | 0.730 | 0.654 | **0.545** | -0.185 (-25.3%) |
| 最高覆盖率 | - | 0.741 | **0.725** | - |
| 平均覆盖率 | - | - | **0.660** | - |
| Episode 600覆盖率 | 0.730 | 0.566 | **0.545** | -0.185 (-25.3%) |

## 二、训练曲线分析

### 关键检查点

| Episode | 覆盖率 | PA | Steps | Epsilon | 备注 |
|---------|--------|----|----|---------|------|
| 10 | 0.691 | 0.049 | 2000.0 | 0.997 | 早期性能良好 |
| 50 | 0.723 | 0.051 | 2000.0 | 0.985 | 接近改进前水平 |
| 100 | 0.725 | 0.051 | 2000.0 | 0.970 | **最高点** |
| 150 | 0.718 | 0.051 | 2000.0 | 0.956 | 开始下降 |
| 200 | 0.703 | 0.050 | 2000.0 | 0.942 | 持续下降 |
| 250 | 0.689 | 0.049 | 2000.0 | 0.928 | 持续下降 |
| 300 | 0.716 | 0.051 | 2000.0 | 0.914 | 略有回升 |
| 350 | 0.634 | 0.045 | 2000.0 | 0.900 | **大幅下降** |
| 400 | 0.634 | 0.045 | 2000.0 | 0.887 | 停滞（加速点） |
| 450 | 0.614 | 0.043 | 2000.0 | 0.874 | 持续下降 |
| 500 | 0.579 | 0.041 | 2000.0 | 0.861 | 持续下降 |
| 550 | 0.605 | 0.043 | 2000.0 | 0.848 | 略有回升 |
| 600 | 0.545 | 0.038 | 2000.0 | 0.835 | **最低点** |

### 性能趋势

- **早期阶段 (Episode 1-100)**: 平均覆盖率 0.713
  - 性能接近改进前的 0.730
  - 最高覆盖率 0.725 (Episode 100)
  - **性能良好**

- **中期阶段 (Episode 100-350)**: 平均覆盖率 0.690
  - Episode 100-300: 波动但总体稳定 (0.689-0.725)
  - Episode 350: **突然大幅下降** (0.634)
  - **性能开始恶化**

- **后期阶段 (Episode 350-600)**: 平均覆盖率 0.597
  - Episode 400: 加速点，但性能未改善
  - Episode 400-600: 持续下降 (0.634 → 0.545)
  - **性能崩溃**

### 关键发现

1. **训练后期性能崩溃**
   - 最高覆盖率: 0.725 (Episode 100)
   - 最终覆盖率: 0.545 (Episode 600)
   - 下降幅度: 0.180 (24.8%)
   - **比第一次改进后的崩溃更严重**

2. **性能崩溃时间点**
   - Episode 350: 突然从 0.716 降至 0.634 (-0.082, -11.5%)
   - Episode 400: 加速点，但性能未改善
   - Episode 400-600: 持续下降

3. **训练曲线特征**
   - 早期性能良好（Episode 1-100）
   - 中期开始波动（Episode 100-300）
   - Episode 350 突然崩溃
   - 后期持续下降（Episode 350-600）

## 三、问题分析

### 1. 可能的原因

#### 问题1: 参数调整方向可能错误
- **当前设置**: 
  - `obstacle_shaping_weight=6.5` (从8.0降低)
  - `epsilon_end=0.10` (从0.12降低)
  - `epsilon_decay=0.9997` (从0.9995减慢)
- **问题**: 
  - 降低障碍回避权重可能导致障碍碰撞增加
  - 降低epsilon_end可能导致探索不足
  - 减慢epsilon_decay可能导致探索时间过长
- **证据**: 性能在Episode 350突然崩溃，之后持续下降

#### 问题2: 恢复机制可能未正确触发
- **当前设置**: `coverage_threshold=0.90`, `drop_tolerance=0.05`
- **问题**: 
  - Episode 350从0.716降至0.634，下降0.082 (11.5%)
  - 但恢复机制可能未触发（需要检查日志）
- **证据**: 性能崩溃后未恢复

#### 问题3: Epsilon衰减策略可能不合适
- **当前设置**: 
  - `epsilon_decay=0.9997` (较慢)
  - `epsilon_accel_episode=400` (加速点)
- **问题**: 
  - Episode 400时epsilon=0.887，仍然很高
  - 加速后性能未改善，反而继续下降
- **证据**: Episode 400-600期间，epsilon从0.887降至0.835，但覆盖率持续下降

#### 问题4: 障碍回避权重可能过低
- **当前设置**: `obstacle_shaping_weight=6.5` (从8.0降低)
- **问题**: 
  - 6.5可能过低，导致障碍碰撞增加
  - 但PA值（0.038-0.051）似乎正常
- **证据**: 需要进一步分析

### 2. 根本原因

**核心问题**: 参数调整可能过于激进，导致训练不稳定：

1. **障碍回避权重降低 (8.0 → 6.5)**: 
   - 可能导致障碍碰撞增加
   - 但PA值正常，可能不是主要原因

2. **探索策略调整 (epsilon_end=0.12 → 0.10, epsilon_decay=0.9995 → 0.9997)**:
   - 降低epsilon_end可能导致探索不足
   - 减慢epsilon_decay可能导致探索时间过长
   - **可能是主要原因**

3. **恢复机制阈值调整 (0.98 → 0.90)**:
   - 阈值降低可能使恢复机制更容易触发
   - 但可能未正确触发或效果不佳

4. **训练不稳定**:
   - Episode 350突然崩溃
   - 之后持续下降
   - **说明训练过程不稳定**

## 四、改进建议

### 1. 重新评估参数调整方向

**当前问题**: 参数调整后性能反而更差，说明调整方向可能错误。

**建议**: 
1. **恢复部分参数到第一次改进前的值**:
   - `obstacle_shaping_weight`: 6.5 → 7.0-7.5 (中等值)
   - `epsilon_end`: 0.10 → 0.11-0.12 (略高)
   - `epsilon_decay`: 0.9997 → 0.9996 (中等速度)

2. **保持恢复机制调整**:
   - `coverage_threshold=0.90` (高障碍密度场景)
   - `drop_tolerance=0.05` (增加容错)

### 2. 优化探索策略

**当前问题**: epsilon衰减策略可能导致探索不足或过度。

**建议**: 
1. **使用更平衡的epsilon设置**:
   - `epsilon_end=0.11` (中等值)
   - `epsilon_decay=0.9996` (中等速度)
   - `epsilon_accel_episode=350` (提前加速，在崩溃前)

2. **移除或调整加速点**:
   - 如果加速点导致性能下降，考虑移除
   - 或者调整加速点的时机

### 3. 增强恢复机制

**当前问题**: 恢复机制可能未正确触发或效果不佳。

**建议**: 
1. **降低恢复阈值**:
   - `coverage_threshold=0.85` (高障碍密度场景)
   - `drop_tolerance=0.06` (增加容错)

2. **提前触发恢复**:
   - `start_episode=100` (提前开始监控)
   - `patience=5` (减少耐心，更快触发)

### 4. 使用课程学习

**建议**: 从低障碍密度模型 warm-start 高障碍密度训练
- 从障碍密度0.10的checkpoint开始
- 帮助模型更好地适应高障碍密度场景

### 5. 增加训练时间

**当前**: `episodes=600`
**建议**: 增加到 800-1000
**理由**: 给模型更多时间学习和适应

## 五、下一步行动

### 1. 立即调整（高优先级）

1. **重新平衡参数**:
   - `obstacle_shaping_weight`: 6.5 → 7.0
   - `epsilon_end`: 0.10 → 0.11
   - `epsilon_decay`: 0.9997 → 0.9996
   - `epsilon_accel_episode`: 400 → 350 (提前加速)

2. **优化恢复机制**:
   - `coverage_threshold`: 0.90 → 0.85 (高障碍密度场景)
   - `drop_tolerance`: 0.05 → 0.06
   - `start_episode`: 150 → 100

### 2. 重新测试

1. 运行调整后的配置
2. 对比三次测试的结果
3. 根据结果进一步优化

### 3. 参数搜索（如果仍不理想）

1. 对障碍回避权重进行网格搜索: [6.0, 7.0, 8.0]
2. 对epsilon_end进行网格搜索: [0.10, 0.11, 0.12]
3. 对epsilon_decay进行网格搜索: [0.9995, 0.9996, 0.9997]
4. 找到最优参数组合

## 六、结论

**第二次参数调整后，性能反而更差**：
- 最终覆盖率: 0.545 (比改进前的0.730低25.3%)
- 训练在Episode 350突然崩溃
- 之后持续下降

**主要问题**:
1. 参数调整方向可能错误
2. 探索策略可能不合适
3. 恢复机制可能未正确触发
4. 训练过程不稳定

**建议**: 
1. **重新评估参数调整方向**
2. **使用更平衡的参数设置**
3. **增强恢复机制**
4. **考虑使用课程学习**

